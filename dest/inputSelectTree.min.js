/*! inputselecttree - v1.0.0 - 2015-12-10 */!function(a,b){var c=function(a){var b=this;b.setting={target:"",api:"",apiRight:"",idkey:"flowId",triggerHandler:function(){},width:0,height:0,data:[]},b.extend(b.setting,a),b.initData(),b.addEvent()};c.prototype={constructor:c,set:function(a,b){this.setting[a]=b},get:function(a){return this.setting[a]},extend:function(a,b){if("object"==typeof b)for(var c in b)a[c]=b[c]},initData:function(){var a=this;this.get("data").length>=1?this.bulid(this.get("data")):b.ajax({url:this.get("api"),type:"post",dataType:"json",success:function(c){b.isArray(c)?a.bulid(c):b.isArray(c.data)?a.bulid(c.data):alert("数据不正确")}})},bulid:function(a){function b(a){var c="",d="";if(d="<li><div class='treeNode @isLast' GuId='@Nodeid'><span class='tree-status tree-ext'></span><span class='tree-ico tree-ext-folder'></span><span class='tree-title'>@data</span>@childHtml</div></li>",a.length<=0)return"";c+="<ul class='list-group list-wrap'>";for(var f=0;f<a.length;f++){var g=a[f].children,i="",k=a[f][e];g?(i=b(g),h=""):h=" list-child",j[k]=a[f],c+=d.split("@isLast").join(h).split("@Nodeid").join(k).split("@data").join(a[f].text).split("@childHtml").join(i)}return c+="</ul>"}var c=this,d=c.get("target"),e=c.get("idkey"),f=c.get("width"),g=c.get("height"),h="",i=c.get("apiRight"),j={};d.after('<input name="treeHideData" type="hidden" /><div class="inputTree hide">'+b(a)+"</div>");var k=d.nextAll("div.inputTree"),l=d.offset().left,m=d.offset().top+d.height()+6;if(f&&g&&k.css({height:g,width:f}),k.css({left:l,top:m}),i){k.after("<div class='selectRight hide'></div>");var n=k.next();f&&g&&n.css({height:g,width:f-30}),n.css({left:l+k.width(),top:m})}d.data({nodeDate:j})},bulidRight:function(a,c){var d=this,e=d.get("target"),f=d.get("idkey"),g=e.nextAll(".inputTree"),h=g.next();h.removeClass("hide"),b.ajax({url:a,type:"post",data:{flowId:c[f]},dataType:"json",success:function(a){var b=a.data,c="";c="<div  class='list-group'>";for(var d=0;d<b.length;d++)c+="<a title='"+b[d].text+"' class='list-group-item right-title' guid='"+b[d][f]+"'>"+b[d].text+"</a>";c+="</div >",h.html(c)}})},addEvent:function(){var a=this,c=a.get("target"),d=(a.get("idkey"),c.nextAll(".inputTree")),e=d.next(),f=a.get("apiRight");d.on("click",".tree-status",function(a){a.preventDefault();var c=b(this);c.hasClass("tree-ext")?c.nextAll("ul").addClass("hide").removeClass("show").end().removeClass("tree-ext").addClass("tree-shut").next().removeClass("tree-ext-folder").addClass("tree-shut-folder"):c.nextAll("ul").addClass("show").removeClass("hide").end().addClass("tree-ext").removeClass("tree-shut").next().addClass("tree-ext-folder").removeClass("tree-shut-folder")}).on("click",".tree-title",function(e){e.preventDefault();var g=b(this),h=g.closest(".treeNode").attr("Guid"),i=c.data().nodeDate,j=i[h];a.get("triggerHandler")(j),f?a.bulidRight(f,j):(d.addClass("hide"),c.val(g.text()))}),e.on("click",".right-title",function(a){a.preventDefault();var f=b(this);d.addClass("hide"),e.addClass("hide"),c.val(f.text())}),c.on("focus",function(a){a.preventDefault(),d.removeClass("hide")})}},b.fn.inputSelectTree=function(a){return a.target=this,this.data(new c(a)),this}}(window,jQuery);